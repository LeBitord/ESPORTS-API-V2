generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String
  role      String   @default("PLAYER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  teams              Team[]         @relation("TeamOwner")
  memberships        TeamMember[]
  organizedTournaments Tournament[] @relation("OrganizedTournaments")

  @@map("users")
}


model Team {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  tag         String       @unique
  game        String
  ownerId     Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  owner       User         @relation("TeamOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members     TeamMember[]
  registrations Registration[]

  matchesAsTeamA Match[] @relation("TeamAMatches")
  matchesAsTeamB Match[] @relation("TeamBMatches")
  wonMatches     Match[] @relation("WinnerMatches")
  
  @@map("teams")
}

model TeamMember {
  id        Int      @id @default(autoincrement())
  teamId    Int
  userId    Int
  role      String   @default("player")
  joinedAt  DateTime @default(now())
  
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([teamId, userId])
  @@map("team_members")
}

model Tournament {
  id            Int      @id @default(autoincrement())
  name          String
  game          String
  startDate     DateTime
  endDate       DateTime
  prizePool     Int?
  maxTeams      Int
  status        String   @default("UPCOMING")
  rules         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  organizerId   Int
  organizer     User     @relation("OrganizedTournaments", fields: [organizerId], references: [id])
  
  registrations Registration[]
   
   matches       Match[]

  @@map("tournaments")
}


model Registration {
  id           Int      @id @default(autoincrement())
  status       String   @default("PENDING")
  updatedAt    DateTime @updatedAt
  
  tournamentId Int
  tournament   Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  teamId       Int
  team         Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([tournamentId, teamId])
  @@map("registrations")
}

model Match {
  id            Int      @id @default(autoincrement())
  tournamentId  Int
  tournament    Tournament @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  
  teamAId       Int
  teamA         Team     @relation("TeamAMatches", fields: [teamAId], references: [id])
  
  teamBId       Int
  teamB         Team     @relation("TeamBMatches", fields: [teamBId], references: [id])
  winner        Team?      @relation("WinnerMatches", fields: [winnerId], references: [id])
  
  scheduledAt   DateTime
  status        String @default("SCHEDULED")
  phase         String?
  
  scoreTeamA    Int?
  scoreTeamB    Int?
  winnerId      Int?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("matches")
}
